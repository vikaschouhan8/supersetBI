{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1298:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return s});var n=r(1),a=r.n(n),o=r(1814),i=r.n(o);r(2083),r(1831);function s(e){return a.a.createElement(\"span\",{className:\"BootstrapSliderWrapper\"},a.a.createElement(i.a,e))}},1831:function(e,t,r){},2588:function(e,t,r){\"use strict\";r.d(t,\"b\",function(){return f}),r.d(t,\"a\",function(){return d}),r.d(t,\"c\",function(){return v});var n=r(11),a=r.n(n),o=r(2786),i=r(22),s=r(2589);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var l=.25,c={LAT_MIN:-90,LAT_MAX:90,LNG_MIN:-180,LNG_MAX:180};function p(e){var t=i.extent(e,function(e){return e[1]}),r=i.extent(e,function(e){return e[0]}),n=t[0]===t[1]?function(e){return[e[0]-l<c.LAT_MIN?c.LAT_MIN:e[0]-l,e[1]+l>c.LAT_MAX?c.LAT_MAX:e[1]+l]}(t):t,a=r[0]===r[1]?function(e){return[e[0]-l<c.LNG_MIN?c.LNG_MIN:e[0]-l,e[1]+l>c.LNG_MAX?c.LNG_MAX:e[1]+l]}(r):r;return[[a[0],n[0]],[a[1],n[1]]]}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{var n=p(t);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(r,!0).forEach(function(t){a()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e,{},Object(o.a)({height:e.height,width:e.width,padding:r,bounds:n}))}catch(t){return console.error(\"Could not auto zoom\",t),e}}function d(e,t,r,n){var a,o,i=e,u=r;return i.js_tooltip&&(u=Object(s.a)(i.js_tooltip)),u&&(a=function(e){e.picked?t({content:u(e),x:e.x,y:e.y+30}):t(null)}),i.js_onclick_href?o=function(e){var t=Object(s.a)(i.js_onclick_href)(e);window.open(t)}:i.table_filter&&void 0!==n&&(o=function(e){return n(e.object[i.line_column])}),{onClick:o,onHover:a,pickable:Boolean(a)}}var h={p1:.01,p5:.05,p95:.95,p99:.99};function v(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"sum\",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return\"count\"===t?function(e){return e.length}:(e=t in h?function(e,n){var a;return a=r?e.sort(function(e,t){return i.ascending(r(e),r(t))}):e.sort(i.ascending),i.quantile(a,h[t],n)}:i[t],r?function(t){return e(t.map(r))}:function(t){return e(t)})}},2589:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return d});var n=r(11),a=r.n(n),o=r(2622),i=r.n(o),s=r(2623),u=r.n(s),l=r(22),c=r(2592);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var f={console:console,_:u.a,colors:c,d3array:l};function d(e,t,r){var n={},o=\"SAFE_EVAL_\"+Math.floor(1e6*Math.random());n[o]={};var s=o+\"=\"+e,u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(r,!0).forEach(function(t){a()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},f,{},t);Object.keys(u).forEach(function(e){n[e]=u[e]});try{return i.a.runInNewContext(s,n,r),n[o]}catch(e){return function(){return e}}}},2592:function(e,t,r){\"use strict\";r.r(t),r.d(t,\"hexToRGB\",function(){return a});var n=r(59);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;if(!e)return[0,0,0,t];var r=Object(n.f)(e);return[r.r,r.g,r.b,t]}},2596:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return x});var n=r(55),a=r.n(n),o=r(11),i=r.n(o),s=r(13),u=r.n(s),l=r(17),c=r.n(l),p=r(14),f=r.n(p),d=r(15),h=r.n(d),v=r(10),m=r.n(v),g=r(16),b=r.n(g),y=r(237),w=r.n(y),O=r(1),C=r.n(O),j=r(0),k=r.n(j),_=r(2616),P=r(2597);r(2618),r(2605);function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(r,!0).forEach(function(t){i()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var V=2e3,E={viewport:k.a.object.isRequired,layers:k.a.array.isRequired,setControlValue:k.a.func,mapStyle:k.a.string,mapboxApiAccessToken:k.a.string.isRequired,onViewportChange:k.a.func},x=function(e){function t(e){var r;return u()(this,t),(r=f()(this,h()(t).call(this,e))).tick=r.tick.bind(m()(r)),r.onViewportChange=r.onViewportChange.bind(m()(r)),r.state={previousViewport:e.viewport,timer:setInterval(r.tick,V)},r}return b()(t,e),c()(t,[{key:\"componentWillUnmount\",value:function(){clearInterval(this.state.timer)}},{key:\"onViewportChange\",value:function(e){var t=Object.assign({},e),r=S({},this.state.previousViewport,{},t);this.props.onViewportChange(r)}},{key:\"tick\",value:function(){var e=this;if(this.state&&!w()(this.state.previousViewport,this.props.viewport)){var t=this.props.setControlValue,r=this.props.viewport;t&&t(\"viewport\",r),this.setState(function(){return{previousViewport:e.props.viewport}})}}},{key:\"layers\",value:function(){return this.props.layers.some(function(e){return\"function\"==typeof e})?this.props.layers.map(function(e){return\"function\"==typeof e?e():e}):this.props.layers}},{key:\"render\",value:function(){var e=this.props.viewport;return C.a.createElement(_.b,a()({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),C.a.createElement(P.i,a()({},e,{layers:this.layers(),initWebGLParameters:!0})))}}],[{key:\"getDerivedStateFromProps\",value:function(e,t){return e.viewport!==t.viewport?{viewport:S({},e.viewport),previousViewport:t.viewport}:null}}]),t}(C.a.Component);x.propTypes=E,x.defaultProps={mapStyle:\"light\",onViewportChange:function(){},setControlValue:function(){}}},2599:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return b});var n=r(13),a=r.n(n),o=r(17),i=r.n(o),s=r(14),u=r.n(s),l=r(15),c=r.n(l),p=r(16),f=r.n(p),d=r(1),h=r.n(d),v=r(0),m=r.n(v),g={label:m.a.string.isRequired,value:m.a.string.isRequired},b=function(e){function t(){return a()(this,t),u()(this,c()(t).apply(this,arguments))}return f()(t,e),i()(t,[{key:\"render\",value:function(){return h.a.createElement(\"div\",null,this.props.label,h.a.createElement(\"strong\",null,this.props.value))}}]),t}(h.a.PureComponent);b.propTypes=g},2605:function(e,t,r){},2606:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return l});var n=r(48),a=r.n(n),o=r(8),i=r.n(o),s=[1,0,1,0,0,0,0];function u(e,t){var r=parseInt(i()(t).format(\"x\"),10);return parseInt(i()(t).add(e).format(\"x\"),10)-r}var l=function(e,t){var r,n,o=i()(Math.min.apply(Math,a()(e))),l=i()(Math.max.apply(Math,a()(e)));if(-1!==t.indexOf(\"/\")){var c=t.split(\"/\",2);c[0].endsWith(\"Z\")?(n=i()(c[0]),r=i.a.duration(c[1])):(n=i()(c[1]),r=i.a.duration(c[0]))}else n=function(e,t){var r=i()(e).subtract(t),n=e.toArray(),a=r.toArray(),o=n.map(function(e,t){return a[t]!==e}).indexOf(!0),u=n.map(function(e,t){if(t===o){var r=e-a[t];return e-(e-s[t])%r}return t<o||-1===o?e:s[t]});return i()(u)}(o,r=i.a.duration(t));for(var p=i()(n);p<o;)p.add(r);for(;p>o;)p.subtract(r);for(var f=i()(n);f>l;)f.subtract(r);for(;f<l;)f.add(r);var d=null!=t?[p,i()(p).add(r)]:[p,f],h=e.every(function(e){return null===e});return{start:parseInt(p.format(\"x\"),10),end:parseInt(f.format(\"x\"),10),getStep:u.bind(this,r),values:d.map(function(e){return parseInt(e.format(\"x\"),10)}),disabled:h}}},2607:function(e,t,r){\"use strict\";var n=r(11),a=r.n(n),o=r(13),i=r.n(o),s=r(17),u=r.n(s),l=r(14),c=r.n(l),p=r(15),f=r.n(p),d=r(10),h=r.n(d),v=r(16),m=r.n(v),g=r(1),b=r.n(g),y=r(0),w=r.n(y),O=r(2596),C=r(1299),j=r.n(C),k=r(35),_=r(1298),P=(r(2608),{start:w.a.number.isRequired,step:w.a.number.isRequired,end:w.a.number.isRequired,values:w.a.array.isRequired,onChange:w.a.func,loopDuration:w.a.number,maxFrames:w.a.number,orientation:w.a.oneOf([\"horizontal\",\"vertical\"]),reversed:w.a.bool,disabled:w.a.bool,range:w.a.bool}),A=function(e){function t(e){var r;i()(this,t),(r=c()(this,f()(t).call(this,e))).state={intervalId:null};var n=e.end-e.start,a=Math.min(e.maxFrames,n/e.step),o=n/a;return r.intervalMilliseconds=e.loopDuration/a,r.increment=o<e.step?e.step:o-o%e.step,r.onChange=r.onChange.bind(h()(r)),r.play=r.play.bind(h()(r)),r.pause=r.pause.bind(h()(r)),r.stepBackward=r.stepBackward.bind(h()(r)),r.stepForward=r.stepForward.bind(h()(r)),r.getPlayClass=r.getPlayClass.bind(h()(r)),r.formatter=r.formatter.bind(h()(r)),r}return m()(t,e),u()(t,[{key:\"componentDidMount\",value:function(){j.a.bind([\"space\"],this.play)}},{key:\"componentWillUnmount\",value:function(){j.a.unbind([\"space\"])}},{key:\"onChange\",value:function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}},{key:\"getPlayClass\",value:function(){return null==this.state.intervalId?\"fa fa-play fa-lg slider-button\":\"fa fa-pause fa-lg slider-button\"}},{key:\"play\",value:function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}},{key:\"pause\",value:function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}},{key:\"stepForward\",value:function(){var e=this,t=this.props,r=t.start,n=t.end,a=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+a]).map(function(t){return t+e.increment}),s=i[1]>n?i[0]-r:0;this.props.onChange(i.map(function(e){return e-s}))}}},{key:\"stepBackward\",value:function(){var e=this,t=this.props,r=t.start,n=t.end,a=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+a]).map(function(t){return t-e.increment}),s=i[0]<r?n-i[1]:0;this.props.onChange(i.map(function(e){return e+s}))}}},{key:\"formatter\",value:function(e){if(this.props.disabled)return Object(k.b)(\"Data has no time steps\");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(function(e){return new Date(e).toUTCString()}).join(\" : \")}},{key:\"render\",value:function(){var e=this.props,t=e.start,r=e.end,n=e.step,a=e.orientation,o=e.reversed,i=e.disabled,s=e.range,u=e.values;return b.a.createElement(\"div\",{className:\"play-slider\"},b.a.createElement(\"div\",{className:\"play-slider-controls padded\"},b.a.createElement(\"i\",{className:\"fa fa-step-backward fa-lg slider-button \",onClick:this.stepBackward}),b.a.createElement(\"i\",{className:this.getPlayClass(),onClick:this.play}),b.a.createElement(\"i\",{className:\"fa fa-step-forward fa-lg slider-button \",onClick:this.stepForward})),b.a.createElement(\"div\",{className:\"play-slider-scrobbler padded\"},b.a.createElement(_.a,{value:s?u:u[0],range:s,formatter:this.formatter,change:this.onChange,min:t,max:r,step:n,orientation:a,reversed:o,disabled:i?\"disabled\":\"enabled\"})))}}]),t}(b.a.PureComponent);function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(r,!0).forEach(function(t){a()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}A.propTypes=P,A.defaultProps={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:\"horizontal\",reversed:!1,disabled:!1,range:!0},r.d(t,\"a\",function(){return x});var E={getLayers:w.a.func.isRequired,start:w.a.number.isRequired,end:w.a.number.isRequired,getStep:w.a.func,values:w.a.array.isRequired,aggregation:w.a.bool,disabled:w.a.bool,viewport:w.a.object.isRequired,children:w.a.node,mapStyle:w.a.string,mapboxApiAccessToken:w.a.string.isRequired,setControlValue:w.a.func,onViewportChange:w.a.func,onValuesChange:w.a.func},x=function(e){function t(e){var r;return i()(this,t),(r=c()(this,f()(t).call(this,e))).onViewportChange=r.onViewportChange.bind(h()(r)),r}return m()(t,e),u()(t,[{key:\"onViewportChange\",value:function(e){var t=this.props.disabled?V({},e):V({},e,{height:e.height+20});this.props.onViewportChange(t)}},{key:\"render\",value:function(){var e=this.props,t=e.start,r=e.end,n=e.getStep,a=e.disabled,o=e.aggregation,i=e.children,s=e.getLayers,u=e.values,l=e.onValuesChange,c=e.viewport,p=e.setControlValue,f=e.mapStyle,d=e.mapboxApiAccessToken,h=s(u),v=V({},c,{height:a?c.height:c.height-20});return b.a.createElement(\"div\",null,b.a.createElement(O.a,{viewport:v,layers:h,setControlValue:p,mapStyle:f,mapboxApiAccessToken:d,onViewportChange:this.onViewportChange}),!a&&b.a.createElement(A,{start:t,end:r,step:n(t),values:u,range:!o,onChange:l}),i)}}]),t}(b.a.Component);x.propTypes=E,x.defaultProps={aggregation:!1,disabled:!1,mapStyle:\"light\",setControlValue:function(){},onViewportChange:function(){},onValuesChange:function(){}}},2608:function(e,t,r){},2611:function(e,t,r){\"use strict\";r.d(t,\"a\",function(){return j});var n=r(11),a=r.n(n),o=r(90),i=r.n(o),s=r(13),u=r.n(s),l=r(17),c=r.n(l),p=r(14),f=r.n(p),d=r(15),h=r.n(d),v=r(16),m=r.n(v),g=r(1),b=r.n(g),y=r(0),w=r.n(y),O=r(567),C=(r(2612),{categories:w.a.object,toggleCategory:w.a.func,showSingleCategory:w.a.func,format:w.a.string,position:w.a.oneOf([null,\"tl\",\"tr\",\"bl\",\"br\"])}),j=function(e){function t(){return u()(this,t),f()(this,h()(t).apply(this,arguments))}return m()(t,e),c()(t,[{key:\"format\",value:function(e){if(!this.props.format)return e;var t=parseFloat(e);return Object(O.b)(this.props.format,t)}},{key:\"formatCategoryLabel\",value:function(e){if(!this.props.format)return e;if(e.includes(\" - \")){var t=e.split(\" - \");return this.format(t[0])+\" - \"+this.format(t[1])}return this.format(e)}},{key:\"render\",value:function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var r=Object.entries(this.props.categories).map(function(e){var r=i()(e,2),n=r[0],a=r[1],o={color:\"rgba(\"+a.color.join(\", \")+\")\"},s=a.enabled?\"◼\":\"◻\";return b.a.createElement(\"li\",{key:n},b.a.createElement(\"a\",{href:\"#\",onClick:function(){return t.props.toggleCategory(n)},onDoubleClick:function(){return t.props.showSingleCategory(n)}},b.a.createElement(\"span\",{style:o},s),\" \",t.formatCategoryLabel(n)))}),n=\"t\"===this.props.position.charAt(0)?\"top\":\"bottom\",o=\"r\"===this.props.position.charAt(1)?\"right\":\"left\",s=(e={position:\"absolute\"},a()(e,n,\"0px\"),a()(e,o,\"10px\"),e);return b.a.createElement(\"div\",{className:\"legend\",style:s},b.a.createElement(\"ul\",{className:\"categories\"},r))}}]),t}(b.a.PureComponent);j.propTypes=C,j.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:\"tr\"}},2612:function(e,t,r){},2619:function(e,t){},2620:function(e,t){},2621:function(e,t){},2722:function(e,t,r){\"use strict\";r.r(t);var n=r(13),a=r.n(n),o=r(17),i=r.n(o),s=r(14),u=r.n(s),l=r(15),c=r.n(l),p=r(10),f=r.n(p),d=r(16),h=r.n(d),v=r(11),m=r.n(v),g=r(48),b=r.n(g),y=r(1),w=r.n(y),O=r(0),C=r.n(O),j=r(2597),k=r(2607),_=r(2611),P=r(2599),A=r(90),S=r.n(A),V=r(22),E=r(175),x=r(264),D=r(866),L=r(2592),F=10;function M(e,t,r){var n=e.break_points,a=e.num_buckets;if(!t)return[];if(void 0===n||0===n.length){var o=a?parseInt(a,10):F,i=Object(V.extent)(t,r),s=S()(i,2),u=s[0],l=s[1];if(void 0===u)return[];var c=(l-u)/o,p=0===c?0:Math.max(0,Math.ceil(Math.log10(1/c))),f=l>l.toFixed(p)?1:0;return Array(o+1+f).fill().map(function(e,t){return(u+t*c).toFixed(p)})}return n.sort(function(e,t){return parseFloat(e)-parseFloat(t)})}function T(e,t,r){var n,a,o=e.break_points,i=e.num_buckets,s=e.linear_color_scheme,u=e.opacity,l=o||i?M({break_points:o,num_buckets:i},t,r):null,c=Array.isArray(s)?new x.a({id:\"custom\",colors:s}):Object(D.a)().get(s);if(null!==l){var p=l.length-1,f=p>1?c.getColors(p):[c.colors[c.colors.length-1]],d=f[0],h=f[f.length-1];f.unshift(d),f.push(h);var v=l.map(function(e){return parseFloat(e)});n=Object(E.i)().domain(v).range(f),a=function(e){return e>l[p]||e<l[0]}}else n=c.createLinearScale(Object(V.extent)(t,r)),a=function(){return!1};return function(e){var t=r(e),o=Object(L.hexToRGB)(n(t));return a(t)?o[3]=0:o[3]=u/100*255,o}}var I=r(2588),N=r(2606),q=r(2589);function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}r.d(t,\"getLayer\",function(){return G});function G(e,t,r,n,a,o,i){var s=e,u=s.fill_color_picker,l=s.stroke_color_picker,c=b()(t.data.features);if(null!=i&&i.forEach(function(e){c=c.filter(e)}),s.js_data_mutator){var p=Object(q.a)(s.js_data_mutator);c=p(c)}var f=s.metric?s.metric.label||s.metric:null,d=null===s.metric?function(){return[u.r,u.g,u.b,255*u.a]}:T(s,c,function(e){return e[f]}),h=function(e){var t=d(e);return a.length>0&&-1===a.indexOf(e[s.line_column])&&(t[3]/=2),t},v=s.line_column&&s.metric&&[\"geohash\",\"zipcode\"].indexOf(s.line_type)>=0?function(e){return function(t){var r=e.metric.label||e.metric;return w.a.createElement(\"div\",{className:\"deckgl-tooltip\"},w.a.createElement(P.a,{label:\"\".concat(e.line_column,\": \"),value:\"\".concat(t.object[e.line_column])}),e.metric&&w.a.createElement(P.a,{label:\"\".concat(r,\": \"),value:\"\".concat(t.object[r])}))}}(s):void 0;return new j.f(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(r,!0).forEach(function(t){m()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({id:\"path-layer-\".concat(s.slice_id),data:c,pickable:!0,filled:s.filled,stroked:s.stroked,getPolygon:function(e){return e.polygon},getFillColor:h,getLineColor:[l.r,l.g,l.b,255*l.a],getLineWidth:s.line_width,extruded:s.extruded,getElevation:function(e){return function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h)},elevationScale:s.multiplier,fp64:!0},Object(I.a)(s,n,v,o)))}var B={formData:C.a.object.isRequired,payload:C.a.object.isRequired,setControlValue:C.a.func.isRequired,viewport:C.a.object.isRequired,onAddFilter:C.a.func,setTooltip:C.a.func},W=function(e){function t(e){var r;return a()(this,t),(r=u()(this,c()(t).call(this,e))).state=t.getDerivedStateFromProps(e),r.getLayers=r.getLayers.bind(f()(r)),r.onSelect=r.onSelect.bind(f()(r)),r.onValuesChange=r.onValuesChange.bind(f()(r)),r.onViewportChange=r.onViewportChange.bind(f()(r)),r}return h()(t,e),i()(t,[{key:\"onSelect\",value:function(e){var t=this.props,r=t.formData,n=t.onAddFilter,a=new Date,o=a-this.state.lastClick<=250,i=b()(this.state.selected);if(o)i.splice(0,i.length,e);else if(r.toggle_polygons){var s=i.indexOf(e);-1===s?i.push(e):i.splice(s,1)}else i.splice(0,1,e);this.setState({selected:i,lastClick:a}),r.table_filter&&n(r.line_column,i,!1,!0)}},{key:\"onValuesChange\",value:function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}},{key:\"onViewportChange\",value:function(e){this.setState({viewport:e})}},{key:\"getLayers\",value:function(e){if(void 0===this.props.payload.data.features)return[];var t=[];return e[0]===e[1]||e[1]===this.end?t.push(function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]}):t.push(function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]}),[G(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip,this.state.selected,this.onSelect,t)]}},{key:\"render\",value:function(){var e=this.props,t=e.payload,r=e.formData,n=e.setControlValue,a=this.state,o=a.start,i=a.end,s=a.getStep,u=a.values,l=a.disabled,c=a.viewport,p=r,f=p.metric?p.metric.label||p.metric:null,d=function(e,t,r){var n=M(e,t,r),a=T(e,t,r),o={};return n.slice(1).forEach(function(t,r){var i=n[r]+\" - \"+n[r+1],s=.5*(parseFloat(n[r])+parseFloat(n[r+1])),u=e.metric?e.metric.label||e.metric:null;o[i]={color:a(m()({},u||e.metric,s)),enabled:!0}}),o}(r,t.data.features,function(e){return e[f]});return w.a.createElement(\"div\",{style:{position:\"relative\"}},w.a.createElement(k.a,{getLayers:this.getLayers,start:o,end:i,getStep:s,values:u,onValuesChange:this.onValuesChange,disabled:l,viewport:c,onViewportChange:this.onViewportChange,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:r.mapbox_style,setControlValue:n,aggregation:!0},null!==r.metric&&w.a.createElement(_.a,{categories:d,position:r.legend_position,format:r.legend_format})))}}],[{key:\"getDerivedStateFromProps\",value:function(e,t){if(t&&e.payload.form_data===t.formData)return null;var r=e.payload.data.features||[],n=r.map(function(e){return e.__timestamp}),a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||\"P1D\",o=Object(N.a)(n,a);return{start:o.start,end:o.end,getStep:o.getStep,values:o.values,disabled:o.disabled,viewport:e.formData.autozoom?Object(I.b)(e.viewport,function(e){return e.map(function(e){return e.polygon}).flat()}(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data}}}]),t}(w.a.Component);W.propTypes=B,W.defaultProps={onAddFilter:function(){},setTooltip:function(){}};t.default=W}}]);","extractedComments":[]}